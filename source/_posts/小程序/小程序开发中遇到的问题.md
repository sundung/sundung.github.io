---
title: 小程序开发中遇到的问题
date: 2021-07-24 16:19:07
tags: 小程序
---

## 问题1: 同一页面存在多个video时，video无法正常播放一直在加载转圈

解决办法:
    不建议同个页面使用多个video组件，建议不超过3个video，如果要实现video列表功能，请进行优化（image列表，选中时将image替换成video）

具体场景:
    开发中可以先全部替换成 image 标签,当用户第一次点击图片时,将图片替换成 video 标签,并自动播放.点击下一个视频的时候,将上一个替换成 image 图片.

## 问题2: 使用 navigator 携带参数过长会被截取

原因:小程序作出限制,路由传参,参数过长,会自动被截取

解决办法: 获取对应id 拿到id去请求对应接口(跳转详情页面)

## 问题3: 如果用户操作系统的控制音乐播放/暂停的按钮,页面不知道,导致页面显示是否播放的状态和真实的音乐播放状态不一致

解决方案:
    1. 通过控制音频的实例 wx.getBackgroundAudioManager() 创建实例 去监听音乐的播放/暂停

## 问题4: 发起网络请求报错

    报错信息:
    ```
     ReferenceError: regeneratorRuntime is not defined
    at Vo.getBanner (index.js? [sm]:15)
    ```
    原因: 小程序不识别 async await 的语法

    解决办法: 开发者工具详情按钮 > 本地设置 > 勾选 (增强编译)
## 问题5: 多行文本设置溢出为省略号无效

    ```
        <text >
          测试数据测试数据测试数据测试数据测试数据测试数据
        </text>
    ```
    ```
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-box-orient: vertical; /*设置对其模式*/
        -webkit-line-clamp: 2; /*设置多行的行数*/
    ```

    解决办法: 写成一行
    ```
    <text >测试数据测试数据测试数据测试数据测试数据测试数据</text>

    ```


## 问题6: 使用行高设置上下对齐无效

    原因:也是 标签换行了

    解决办法:写成一行


## 问题7: 小程序路由传参有问题

    // 不能直接将song对象作为参数传递，长度过长，会被自动截取掉
      // url: '/pages/songDetail/songDetail?songPackage=' + JSON.stringify(songPackage)

## 问题8: setData 异步更新

```
    问题: 请求接口更新最新数据
    // 注意 不能直接在setData中更新,异步获取不到数据
    // 更新歌曲连接
        this.setData({
          musicLink:musicLinkData.data[0].url
        })
    // 正确写法
        musicLink = musicLinkData.data[0].url
        // 更新歌曲连接
        this.setData({
          musicLink
        })

原因: setData 异步更新的
```
问题9: 小程序部署后台时报错

```
    报错信息:
    Error: listen EADDRNOTAVAIL: address not available 182.92.70.146:3000

    解决办法: server.listen(3000, '0.0.0.0');

    网上地址:https://stackoverflow.com/questions/61086835/nodejs-error-listen-eaddrnotavail-address-not-available
```

问题10: 小程序不播放背景音乐

```
    // 创建控制音乐播放的实例
    this.backgroundAudioManager = wx.getBackgroundAudioManager();
    // 传入对应的音乐播放连接
    this.backgroundAudioManager.src = musicLink;
    // 注意必须要传title 否则不会播放音乐
    this.backgroundAudioManager.title = this.data.personal_fm[0].name;

```
